<!doctype html>
<meta charset="UTF-8">

<head>
  <script src="http://localhost:8080/fractal.js"></script>
</head>

<body>
<input type="button" onclick="loadData()" value="load data"/>
<input type="button" onclick="deleteData()" value="delete data"/>
<input type="button" onclick="loadState()" value="load state"/>
<input type="text" class="state-ids" style="width: 50vw;">
<div class="containers">
  <div class="chart chart-1"></div>
  <div class="chart chart-2"></div>
  <div class="chart chart-3"></div>
  <div class="chart chart-4"></div>
  <div class="chart copy-1"></div>
  <div class="chart copy-2"></div>
  <div class="chart copy-3"></div>
</div>
</body>

<script>
  /* eslint-disable */

  const fjs = fractal.init({
    handler: 'test',
    dataSource: 'http://localhost',
    fractalisNode: 'http://localhost:5000',
    getAuth () {
      return {user: '', passwd: ''}
    }
  })
  fjs.setSubsets([
    [...new Array(100).keys()],
    [...new Array(500).keys()].slice(100, 200),
    [...new Array(500).keys()].slice(200, 300)
  ])
  function loadData () {
    fjs.loadData([
      {
        data_type: 'numerical_array',
        label: 'Expression Data',
        num_samples: 300,
        num_features: 100
      },
      {
        data_type: 'numerical',
        label: 'Numerical Data 1',
        num_samples: 300
      },
      {
        data_type: 'numerical',
        label: 'Numerical Data 2',
        num_samples: 300
      },
      {
        data_type: 'numerical',
        label: 'Numerical Data 3',
        num_samples: 300
      },
      {
        data_type: 'categorical',
        label: 'Categorical Data 1',
        num_samples: 300,
        values: ['A', 'B', 'C', 'D']
      },
      {
        data_type: 'categorical',
        label: 'Categorical Data 2',
        num_samples: 300,
        values:['X', 'Y']
      }
    ])
  }

  function deleteData () {
    fjs.clearCache()
  }

  function loadState () {
    document.querySelector('.state-ids').value.split('+').forEach((id, i) => {
      if (id.length) {
        fjs.id2chart(`.copy-${i+1}`, id)
      }
    })
  }

  const chartStateIDs = []
  function setCharts () {
    const vms = [
      fjs.setChart('correlation-analysis', '.chart-1'),
      fjs.setChart('boxplot', '.chart-2'),
      fjs.setChart('pca-analysis', '.chart-3'),
      fjs.setChart('correlation-analysis', '.chart-4')
    ]
    vms.forEach((vm, i) => {
      fjs.chart2id(vm, id => {
        chartStateIDs[i] = id
        document.querySelector('.state-ids').value = chartStateIDs.join('+')
      })
    })
  }

  window.addEventListener('load', () => {
    setCharts()
  })
</script>

<style>
  .containers {
  }

  .chart {
      float: left;
      width: 48%;
      height: 50vh;
  }
</style>
