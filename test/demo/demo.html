<!doctype html>
<meta charset="UTF-8">

<head>
  <script src="http://localhost:8080/fractal.js"></script>
</head>

<body>
<h1>Fractalis Test Page</h1>
<p>
  This page is for demonstration purpose only.
  It showcases the functionality of Fractalis for researchers and
  serves as an example on how to use the API for developers.
</p>
<input type="button" onclick="loadData()" value="Prepare data for analysis"/>
<input type="button" onclick="deleteData()" value="Clear analysis cache"/>
<!--<input type="button" onclick="loadState()" value="load state"/>-->
<label for="state-ids">State ID:</label>
<input type="text" id="state-ids" style="width: 20vw;">
<br/>
<br/>
<div class="charts">
  <div class="chart chart-1"></div>
  <div class="chart chart-2"></div>
  <div class="chart chart-3"></div>
  <div class="chart chart-4"></div>
  <div class="chart chart-5"></div>
  <div class="chart chart-6"></div>
  <div class="chart chart-7"></div>
  <div class="chart chart-8"></div>
</div>

</body>

<script>
  /* eslint-disable */

  const fjs = fractal.init({
    handler: 'test',
    dataSource: 'http://localhost',
    fractalisNode: 'http://localhost',
    getAuth () {
      return {token: ''}
    },
    options: {
      controlPanelPosition: 'right'
    }
  })

  fjs.setSubsets([
  ])

  function loadData () {
    fjs.loadData([
      {
        data_type: 'numerical_array',
        label: 'Expression Data',
        num_samples: 300,
        num_features: 100
      },
      {
        data_type: 'numerical',
        label: 'Numerical Data 1',
        num_samples: 300
      },
      {
        data_type: 'numerical',
        label: 'Numerical Data 2',
        num_samples: 300
      },
      {
        data_type: 'numerical',
        label: 'Numerical Data 3',
        num_samples: 300
      },
      {
        data_type: 'categorical',
        label: 'Categorical Data 1',
        num_samples: 300,
        values: ['A', 'B', 'C', 'D']
      },
      {
        data_type: 'categorical',
        label: 'Categorical Data 2',
        num_samples: 300,
        values:['X', 'Y']
      }
    ])
  }

  function deleteData () {
    fjs.clearCache()
  }

  function loadState () {
    document.querySelector('.state-ids').value.split('+').forEach((id, i) => {
      if (id.length) {
        fjs.id2chart(`.copy-${i+1}`, id)
      }
    })
  }

  const chartStateIDs = []
  function setCharts () {
    const vms = [
      fjs.setChart('correlation-analysis', '.chart-1'),
      fjs.setChart('correlation-analysis', '.chart-2'),
      fjs.setChart('correlation-analysis', '.chart-3'),
      fjs.setChart('correlation-analysis', '.chart-4'),
      fjs.setChart('boxplot', '.chart-5'),
      fjs.setChart('boxplot', '.chart-6'),
      fjs.setChart('pca-analysis', '.chart-7'),
      fjs.setChart('pca-analysis', '.chart-8')
    ]
    vms.forEach((vm, i) => {
      fjs.chart2id(vm, id => {
        chartStateIDs[i] = id
        document.querySelector('#state-ids').value = chartStateIDs.join('+')
      })
    })
  }

  window.addEventListener('load', () => {
    setCharts()
  })
</script>

<style>
  .charts {
  }

  .chart {
    float: left;
    height: 20vw;
    width: 20vw;
  }
</style>
